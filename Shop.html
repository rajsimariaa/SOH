<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shades of Hue | Shop</title>
    
    <!-- Load Styles (Tailwind CSS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configure Modules (Import Map) -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.344.0",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
      }
    }
    </script>

    <!-- Load Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .overflow-y-auto::-webkit-scrollbar { width: 6px; }
        .overflow-y-auto::-webkit-scrollbar-track { background: transparent; }
        .overflow-y-auto::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">
    <div id="shop-root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import ReactDOM from 'react-dom/client';
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword } from 'firebase/auth';
        import { 
            getFirestore, collection, addDoc, query, where, onSnapshot, serverTimestamp, orderBy 
        } from 'firebase/firestore';
        import { initializeApp } from 'firebase/app';
        import { 
            ShoppingBag, ShoppingCart, X, Plus, Minus, ArrowLeft, CreditCard, 
            Package, CheckCircle, Home, Search, Heart
        } from 'lucide-react';

        // --- FIREBASE CONFIGURATION (Matches Main Site) ---
        const firebaseConfig = {
            apiKey: "AIzaSyC907raHdPtNtNxBNLxImf7i-FfPIvglhE",
            authDomain: "sohh-7b016.firebaseapp.com",
            projectId: "sohh-7b016",
            storageBucket: "sohh-7b016.firebasestorage.app",
            messagingSenderId: "436729414470",
            appId: "1:436729414470:web:da0db38fedb21aaeac5b47",
            measurementId: "G-SDNWQPHX47"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- MOCK PRODUCT DATA ---
        const PRODUCTS = [
            { id: 1, name: "Pride Progress Tote", price: 499, category: "Accessories", image: "https://api.dicebear.com/7.x/icons/svg?seed=tote&backgroundColor=b6e3f4" },
            { id: 2, name: "Pronoun Pin Set", price: 299, category: "Badges", image: "https://api.dicebear.com/7.x/icons/svg?seed=pins&backgroundColor=ffdfbf" },
            { id: 3, name: "Community Tee (White)", price: 899, category: "Apparel", image: "https://api.dicebear.com/7.x/icons/svg?seed=tee&backgroundColor=c0aede" },
            { id: 4, name: "Rainbow Lanyard", price: 199, category: "Accessories", image: "https://api.dicebear.com/7.x/icons/svg?seed=lanyard&backgroundColor=ffd5dc" },
            { id: 5, name: "Inclusive History Book", price: 650, category: "Books", image: "https://api.dicebear.com/7.x/icons/svg?seed=book&backgroundColor=d1d4f9" },
            { id: 6, name: "Support Sticker Pack", price: 149, category: "Stationery", image: "https://api.dicebear.com/7.x/icons/svg?seed=stickers&backgroundColor=c1f0c1" },
        ];

        // --- COMPONENTS ---

        const Button = ({ children, onClick, variant = 'primary', className = '', disabled = false }) => {
            const base = "px-4 py-2 rounded-lg font-medium transition-all flex items-center justify-center gap-2 disabled:opacity-50";
            const variants = {
                primary: "bg-indigo-600 text-white hover:bg-indigo-700 shadow-md shadow-indigo-200",
                secondary: "bg-white text-gray-700 border border-gray-300 hover:bg-gray-50",
                danger: "bg-rose-600 text-white hover:bg-rose-700",
                ghost: "text-gray-600 hover:bg-gray-100"
            };
            return <button onClick={onClick} disabled={disabled} className={`${base} ${variants[variant]} ${className}`}>{children}</button>;
        };

        function Navbar({ cartCount, setView, user }) {
            return (
                <nav className="bg-white border-b border-gray-200 sticky top-0 z-50">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex justify-between items-center">
                        <div className="flex items-center gap-4">
                            <a href="index.html" className="text-gray-500 hover:text-indigo-600 transition-colors flex items-center gap-1 text-sm font-medium">
                                <ArrowLeft size={16} /> Back to Main Site
                            </a>
                            <div className="h-6 w-px bg-gray-300 hidden md:block"></div>
                            <button onClick={() => setView('home')} className="flex items-center gap-2">
                                <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-white font-bold">S</div>
                                <span className="font-bold text-xl text-gray-900">Shop</span>
                            </button>
                        </div>
                        
                        <div className="flex items-center gap-4">
                            {user && (
                                <button onClick={() => setView('orders')} className="text-sm font-medium text-gray-600 hover:text-indigo-600 hidden md:block">
                                    My Orders
                                </button>
                            )}
                            <button onClick={() => setView('cart')} className="relative p-2 text-gray-600 hover:bg-gray-100 rounded-full transition-colors">
                                <ShoppingCart size={24} />
                                {cartCount > 0 && (
                                    <span className="absolute top-0 right-0 w-5 h-5 bg-rose-500 text-white text-xs font-bold rounded-full flex items-center justify-center border-2 border-white">
                                        {cartCount}
                                    </span>
                                )}
                            </button>
                        </div>
                    </div>
                </nav>
            );
        }

        function ProductCard({ product, onAdd }) {
            return (
                <div className="bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden hover:shadow-md transition-shadow group">
                    <div className="bg-gray-50 h-48 flex items-center justify-center p-4 relative">
                        <img src={product.image} alt={product.name} className="h-32 w-32 object-contain group-hover:scale-110 transition-transform duration-300" />
                        <span className="absolute top-3 left-3 px-2 py-1 bg-white/90 backdrop-blur text-xs font-bold text-gray-500 rounded-md">
                            {product.category}
                        </span>
                    </div>
                    <div className="p-4">
                        <div className="flex justify-between items-start mb-2">
                            <h3 className="font-bold text-gray-900">{product.name}</h3>
                            <span className="font-bold text-indigo-600">₹{product.price}</span>
                        </div>
                        <Button onClick={() => onAdd(product)} variant="secondary" className="w-full text-sm mt-2">
                            <Plus size={16} /> Add to Cart
                        </Button>
                    </div>
                </div>
            );
        }

        function Cart({ cart, updateQty, removeFromCart, setView }) {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            if (cart.length === 0) {
                return (
                    <div className="text-center py-20">
                        <div className="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400">
                            <ShoppingCart size={40} />
                        </div>
                        <h2 className="text-2xl font-bold text-gray-900">Your cart is empty</h2>
                        <p className="text-gray-500 mt-2 mb-6">Looks like you haven't added anything yet.</p>
                        <Button onClick={() => setView('home')}>Start Shopping</Button>
                    </div>
                );
            }

            return (
                <div className="max-w-4xl mx-auto grid md:grid-cols-3 gap-8">
                    <div className="md:col-span-2 space-y-4">
                        <h2 className="text-2xl font-bold text-gray-900 mb-4">Shopping Cart ({cart.length})</h2>
                        {cart.map(item => (
                            <div key={item.id} className="flex gap-4 bg-white p-4 rounded-xl border border-gray-100 shadow-sm">
                                <div className="w-20 h-20 bg-gray-50 rounded-lg flex-shrink-0 flex items-center justify-center">
                                    <img src={item.image} alt={item.name} className="w-12 h-12" />
                                </div>
                                <div className="flex-grow flex flex-col justify-between">
                                    <div className="flex justify-between">
                                        <h3 className="font-bold text-gray-900">{item.name}</h3>
                                        <button onClick={() => removeFromCart(item.id)} className="text-gray-400 hover:text-red-500"><X size={18} /></button>
                                    </div>
                                    <div className="flex justify-between items-end">
                                        <div className="flex items-center gap-3 bg-gray-50 rounded-lg p-1">
                                            <button onClick={() => updateQty(item.id, -1)} className="p-1 hover:bg-white rounded shadow-sm transition-colors" disabled={item.quantity <= 1}><Minus size={14} /></button>
                                            <span className="text-sm font-bold w-4 text-center">{item.quantity}</span>
                                            <button onClick={() => updateQty(item.id, 1)} className="p-1 hover:bg-white rounded shadow-sm transition-colors"><Plus size={14} /></button>
                                        </div>
                                        <span className="font-bold text-indigo-600">₹{item.price * item.quantity}</span>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                    <div className="md:col-span-1">
                        <div className="bg-white p-6 rounded-xl border border-gray-100 shadow-sm sticky top-24">
                            <h3 className="font-bold text-gray-900 mb-4">Order Summary</h3>
                            <div className="space-y-2 text-sm text-gray-600 mb-4">
                                <div className="flex justify-between"><span>Subtotal</span><span>₹{total}</span></div>
                                <div className="flex justify-between"><span>Shipping</span><span className="text-green-600">Free</span></div>
                            </div>
                            <div className="border-t border-gray-100 pt-4 flex justify-between font-bold text-lg text-gray-900 mb-6">
                                <span>Total</span>
                                <span>₹{total}</span>
                            </div>
                            <Button onClick={() => setView('checkout')} className="w-full">Proceed to Checkout</Button>
                        </div>
                    </div>
                </div>
            );
        }

        function Checkout({ cart, user, clearCart, setView }) {
            const [loading, setLoading] = useState(false);
            const [formData, setFormData] = useState({ name: user?.displayName || '', address: '', city: '', zip: '' });
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!user) {
                    alert("Please log in via the main site to place an order.");
                    return;
                }
                setLoading(true);
                try {
                    await addDoc(collection(db, 'orders'), {
                        userId: user.uid,
                        userEmail: user.email,
                        items: cart,
                        total: total,
                        shippingDetails: formData,
                        status: 'placed',
                        createdAt: serverTimestamp()
                    });
                    clearCart();
                    setView('success');
                } catch (error) {
                    console.error("Order error:", error);
                    alert("Failed to place order. " + error.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="max-w-2xl mx-auto bg-white p-8 rounded-xl border border-gray-200 shadow-sm">
                    <h2 className="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                        <CreditCard className="text-indigo-600" /> Checkout
                    </h2>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                            <input required className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Shipping Address</label>
                            <textarea required rows="3" className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" value={formData.address} onChange={e => setFormData({...formData, address: e.target.value})} />
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">City</label>
                                <input required className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" value={formData.city} onChange={e => setFormData({...formData, city: e.target.value})} />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">ZIP / Postal Code</label>
                                <input required className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" value={formData.zip} onChange={e => setFormData({...formData, zip: e.target.value})} />
                            </div>
                        </div>
                        
                        <div className="bg-gray-50 p-4 rounded-lg mt-4">
                            <div className="flex justify-between font-bold text-gray-900">
                                <span>Order Total</span>
                                <span>₹{total}</span>
                            </div>
                            <p className="text-xs text-gray-500 mt-2">By placing this order, you agree to our terms of service.</p>
                        </div>

                        <div className="flex gap-3 pt-4">
                            <Button variant="secondary" onClick={() => setView('cart')} className="flex-1">Back to Cart</Button>
                            <Button type="submit" disabled={loading} className="flex-1">
                                {loading ? 'Processing...' : 'Place Order'}
                            </Button>
                        </div>
                    </form>
                </div>
            );
        }

        function OrderSuccess({ setView }) {
            return (
                <div className="text-center py-20 max-w-md mx-auto">
                    <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-green-600">
                        <CheckCircle size={40} />
                    </div>
                    <h2 className="text-3xl font-bold text-gray-900 mb-2">Order Placed!</h2>
                    <p className="text-gray-600 mb-8">Thank you for supporting Shades of Hue. We've received your order and will begin processing it shortly.</p>
                    <div className="space-y-3">
                        <Button onClick={() => setView('orders')} className="w-full">View My Orders</Button>
                        <Button variant="ghost" onClick={() => setView('home')} className="w-full">Continue Shopping</Button>
                    </div>
                </div>
            );
        }

        function OrderHistory({ user, setView }) {
            const [orders, setOrders] = useState([]);
            
            useEffect(() => {
                if(!user) return;
                const q = query(collection(db, 'orders'), where('userId', '==', user.uid), orderBy('createdAt', 'desc'));
                const unsub = onSnapshot(q, (snapshot) => {
                    setOrders(snapshot.docs.map(doc => ({id: doc.id, ...doc.data()})));
                });
                return () => unsub();
            }, [user]);

            return (
                <div className="max-w-4xl mx-auto">
                    <div className="flex items-center gap-4 mb-6">
                        <button onClick={() => setView('home')} className="p-2 hover:bg-gray-100 rounded-full"><ArrowLeft size={20}/></button>
                        <h2 className="text-2xl font-bold text-gray-900">My Orders</h2>
                    </div>
                    <div className="space-y-4">
                        {orders.map(order => (
                            <div key={order.id} className="bg-white border border-gray-200 rounded-xl p-6 shadow-sm">
                                <div className="flex justify-between items-start mb-4">
                                    <div>
                                        <div className="text-xs text-gray-500 uppercase font-bold tracking-wider">Order #{order.id.slice(0, 8)}</div>
                                        <div className="text-sm text-gray-500">{order.createdAt?.toDate().toLocaleDateString()}</div>
                                    </div>
                                    <Badge color={order.status === 'placed' ? 'green' : 'gray'}>{order.status}</Badge>
                                </div>
                                <div className="space-y-2 mb-4 border-t border-b border-gray-100 py-3">
                                    {order.items.map((item, i) => (
                                        <div key={i} className="flex justify-between text-sm">
                                            <span className="text-gray-800">{item.quantity}x {item.name}</span>
                                            <span className="font-medium">₹{item.price * item.quantity}</span>
                                        </div>
                                    ))}
                                </div>
                                <div className="flex justify-between items-center font-bold text-gray-900">
                                    <span>Total</span>
                                    <span>₹{order.total}</span>
                                </div>
                            </div>
                        ))}
                        {orders.length === 0 && <div className="text-center py-10 text-gray-500">No past orders found.</div>}
                    </div>
                </div>
            );
        }

        // --- MAIN APP COMPONENT ---
        function ShopApp() {
            const [view, setView] = useState('home'); // home, cart, checkout, success, orders
            const [cart, setCart] = useState([]);
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const unsub = onAuthStateChanged(auth, (u) => {
                    setUser(u);
                    setLoading(false);
                });
                return () => unsub();
            }, []);

            // Cart Logic
            const addToCart = (product) => {
                setCart(prev => {
                    const existing = prev.find(item => item.id === product.id);
                    if (existing) {
                        return prev.map(item => item.id === product.id ? { ...item, quantity: item.quantity + 1 } : item);
                    }
                    return [...prev, { ...product, quantity: 1 }];
                });
                // Optional: Show toast
            };

            const removeFromCart = (id) => setCart(prev => prev.filter(item => item.id !== id));
            
            const updateQty = (id, delta) => {
                setCart(prev => prev.map(item => {
                    if (item.id === id) return { ...item, quantity: Math.max(1, item.quantity + delta) };
                    return item;
                }));
            };

            const clearCart = () => setCart([]);

            const cartCount = cart.reduce((sum, item) => sum + item.quantity, 0);

            if (loading) return <div className="min-h-screen flex items-center justify-center"><div className="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div></div>;

            return (
                <div className="min-h-screen flex flex-col">
                    <Navbar cartCount={cartCount} setView={setView} user={user} />
                    
                    <main className="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
                        {view === 'home' && (
                            <>
                                <div className="mb-8 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-2xl p-8 text-white text-center shadow-lg">
                                    <h1 className="text-3xl font-bold mb-2">Shades of Hue Store</h1>
                                    <p className="opacity-90">Support the community with every purchase.</p>
                                </div>
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {PRODUCTS.map(p => (
                                        <ProductCard key={p.id} product={p} onAdd={addToCart} />
                                    ))}
                                </div>
                            </>
                        )}

                        {view === 'cart' && <Cart cart={cart} updateQty={updateQty} removeFromCart={removeFromCart} setView={setView} />}
                        
                        {view === 'checkout' && <Checkout cart={cart} user={user} clearCart={clearCart} setView={setView} />}
                        
                        {view === 'success' && <OrderSuccess setView={setView} />}
                        
                        {view === 'orders' && <OrderHistory user={user} setView={setView} />}
                    </main>

                    <footer className="bg-white border-t border-gray-200 py-8 text-center text-sm text-gray-500">
                        <p>&copy; {new Date().getFullYear()} Shades of Hue Shop. All rights reserved.</p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('shop-root'));
        root.render(<ShopApp />);
    </script>
</body>
</html>